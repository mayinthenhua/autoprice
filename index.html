<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
         body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            width: 350mm;
            font-size: 13px;
        }
        html, body {
            display: grid;
        }
        .col-label-1{
            background-color: lightseagreen;
        }
        .m-w-80{   
           min-width: 80px;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <div class="row" style="height: 50px;">
        <h1 class="mb-3" style="text-align: center; height: 50px; padding-bottom: 0px;">TÍNH ĐƠN GIÁ</h1>
    </div>
    <div class="row" style="margin: 0px 20px; padding-top: 20px; ">
        
        <div class="col-md-6 col-12" >
            
            <div class="card-body">
                <form>
                    <div class="row mb-3">
                        <label class="col-sm-1 col-form-label col-label-1 text-end" >HH</label>
                        <div class="col-sm-2 text-center">
                            Số lượng
                        </div>
                        <div class="col-sm-2  text-center">
                           Thuế (%)
                        </div>
                        <div class="col-sm-3  text-center">
                           Đơn giá
                        </div>
                        <label class="col-sm-1 col-form-label text-end" >±</label>
                        <div class="col-sm-3  text-center">
                            Phạm vi thay đổi giá
                        </div>
                    </div>
    
                  <div class="row mb-3">
                    <label class="col-sm-1 col-form-label col-label-1 text-end" >1</label>
                    <div class="col-sm-2">
                        <input id="quanlity1" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-2">
                        <input id="taxRate1" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-3">
                        <input id="price1"  class="form-control text-end m-w-80" type="text">
                    </div>
                    <label class="col-sm-1 col-form-label text-end" >±</label>
                    <div class="col-sm-3">
                        <input id="range1"  class="form-control  text-end m-w-80" type="text" >
                    </div>
                  </div>
                  <!---->
                  <div class="row mb-3">
                    <label class="col-sm-1 col-form-label col-label-1 text-end" >2</label>
                    <div class="col-sm-2">
                        <input id="quanlity2" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-2">
                        <input id="taxRate2" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-3">
                        <input id="price2"  class="form-control  text-end  m-w-80" type="text">
                    </div>
                    <label class="col-sm-1 col-form-label text-end" >±</label>
                    <div class="col-sm-3">
                        <input id="range2"  class="form-control  text-end m-w-80" type="text" >
                    </div>
                  </div>
    
                   <!---->
                   <div class="row mb-3">
                    <label class="col-sm-1 col-form-label col-label-1 text-end" >3</label>
                    <div class="col-sm-2">
                        <input id="quanlity3" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-2">
                        <input id="taxRate3" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-3">
                        <input id="price3"  class="form-control  text-end  m-w-80" type="text">
                    </div>
                    <label class="col-sm-1 col-form-label text-end" >±</label>
                    <div class="col-sm-3">
                        <input id="range3"  class="form-control  text-end m-w-80" type="text" >
                    </div>
                  </div>
                  <!---->
                  <div class="row mb-3">
                    <label class="col-sm-1 col-form-label col-label-1 text-end" >4</label>
                    <div class="col-sm-2">
                        <input id="quanlity4" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-2">
                        <input id="taxRate4" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-3">
                        <input id="price4"  class="form-control  text-end  m-w-80" type="text">
                    </div>
                    <label class="col-sm-1 col-form-label text-end" >±</label>
                    <div class="col-sm-3">
                        <input id="range4"  class="form-control  text-end m-w-80" type="text" >
                    </div>
                  </div>
                  <!---->
                  <div class="row mb-3">
                    <label class="col-sm-1 col-form-label col-label-1 text-end" >5</label>
                    <div class="col-sm-2">
                        <input id="quanlity5" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-2">
                        <input id="taxRate5" class="form-control text-center m-w-80" type="text">
                    </div>
                    <div class="col-sm-3">
                        <input id="price5"  class="form-control  text-end  m-w-80" type="text">
                    </div>
                    <label class="col-sm-1 col-form-label text-end" >±</label>
                    <div class="col-sm-3">
                        <input id="range5"  class="form-control  text-end m-w-80" type="text" >
                    </div>
                  </div>
                  <hr>
                  <div  class="row mb-3">
                    <label class="col-sm-8 col-form-label text-end" >Giá trị hóa đơn mong muốn</label>
                    <div class="col-sm-4">
                        <input id="total"  class="form-control text-end" type="text" >
                    </div>
                  </div>
                  <div  class="row">
                    <label class="col-form-label text-end" id="total-range" ></label>
                    
                  </div>
                  
                  <div  class="row mb-3">
                    <label class="col-sm-4 col-form-label text-end" >Thời gian tìm kết quả:</label>
                    <div class="col-sm-3">
                        <input id="input-timeout"  class="form-control" type="text" >
                    </div>
                    <label class="col-sm-2 col-form-label text-end" >Tốc độ:</label>
                    <div class="col-sm-3">
                        <input id="input-speed"  class="form-control" type="text" >
                    </div>
                  </div>
                  
    
                </form>
            </div>
        </div>
        <div class="col-md-6  col-12">
            <div class="card-body" >
                <div class="row  text-end">
                    <button id="btnResult" type="button" class="btn btn-primary" style="margin: 0px 15px;">Tìm kết quả</button>
                  </div>
                  <div class="mt-3" >
                    <ul id="list-result" class="list-group" >
                      
                    </ul>
                  </div>
            </div>
        </div>
    </div>

    
<script>
    function parseNumber(value) {
        return  parseInt(value.replace(/,/g, '',10));
    }
    function formatNumber(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Lắng nghe sự kiện trên tất cả các input có type=text
        document.querySelectorAll('input[type="text"]').forEach(function(input) {
            input.addEventListener('keypress', function(e) {
                if (e.key !== '.' && (e.key < '0' || e.key > '9')) {
                    e.preventDefault();
                }
            });
            input.addEventListener('input', function(e) {
                // Lấy giá trị số hiện tại (bỏ dấu phẩy)
                let value = e.target.value.replace(/,/g, '');

                // Kiểm tra nếu là số hợp lệ
                if (!isNaN(value) && value !== "") {
                    // Định dạng lại giá trị với dấu phân cách
                    e.target.value = formatNumber(value);
                } else {
                    e.target.value = value; // Giữ nguyên giá trị nếu không hợp lệ
                }
            });

            // Khi người dùng focus vào input, xóa dấu phân cách để chỉnh sửa dễ dàng
            input.addEventListener('focus', function(e) {
                e.target.value = e.target.value.replace(/,/g, '');
            });

            // Khi người dùng blur, thêm lại dấu phân cách
            input.addEventListener('blur', function(e) {
                let value = e.target.value.replace(/,/g, '');
                if (!isNaN(value) && value !== "") {
                    e.target.value = formatNumber(value);
                }
            });
        });
</script>
<script>
    $(document).ready(function(){
        
        $('#quanlity1').val(5);
        $('#taxRate1').val(8);
        $('#price1').val( formatNumber(1550000) );
        $('#range1').val(0);

        $('#quanlity2').val(1);
        $('#taxRate2').val(8);
        $('#price2').val(formatNumber(440000));
        $('#range2').val(formatNumber(10000));

        $('#quanlity3').val(0);
        $('#taxRate3').val(10);
        $('#price3').val(formatNumber(2000));
        $('#range3').val(0);

        $('#quanlity4').val(0);
        $('#taxRate4').val(10);
        $('#price4').val(0);
        $('#range4').val(0);

        $('#quanlity5').val(0);
        $('#taxRate5').val(10);
        $('#price5').val(0);
        $('#range5').val(0);
        $('#total').val(formatNumber(8910000));
        $('#input-timeout').val(formatNumber(3000));
        $('#input-speed').val(30);
    $('#btnResult').click(function(){
        
        let quanlity1 = parseNumber( $('#quanlity1').val(),10); 
        let taxRate1 =parseNumber($('#taxRate1').val(),10);
        let price1 =parseNumber($('#price1').val(),10);
        let range1 =parseNumber($('#range1').val(),10);

        let quanlity2 =  parseNumber($('#quanlity2').val(),10);
        let taxRate2 =parseNumber($('#taxRate2').val(),10);
        let price2 =parseNumber($('#price2').val(),10);
        let range2 =parseNumber($('#range2').val(),10);

        let quanlity3 = parseNumber( $('#quanlity3').val(),10);
        let taxRate3 =parseNumber($('#taxRate3').val(),10);
        let price3 =parseNumber($('#price3').val(),10);
        let range3 =parseNumber($('#range3').val(),10);

        let quanlity4 = parseNumber( $('#quanlity4').val(),10);
        let taxRate4 =parseNumber($('#taxRate4').val(),10);
        let price4 =parseNumber($('#price4').val(),10);
        let range4 =parseNumber($('#range4').val(),10);

        let quanlity5 = parseNumber( $('#quanlity5').val(),10);
        let taxRate5 =parseNumber($('#taxRate5').val(),10);
        let price5 =parseNumber($('#price5').val(),10);
        let range5 =parseNumber($('#range5').val(),10);
        let total =parseNumber($('#total').val(),10);
        let timeout =parseNumber($('#input-timeout').val(),10);
        let step =parseNumber($('#input-speed').val(),10);
        let totalRange = [];
        let found=false;
        $('#list-result').empty();
        const startTime = Date.now();
        for (let x = price1 - range1; x <= price1 + range1; x += step) {
            let sub1 = quanlity1 * x;
            let taxVal1 = sub1 * taxRate1 / 100;
            for (let y = price2 - range2; y <= price2 + range2; y += step) {
                let sub2 = quanlity2 * y;
                let taxVal2 = sub2 * taxRate2 / 100;
                for (let z = price3 - range3; z <= price3 + range3; z += step) {
                    let sub3 = quanlity3 * z;
                    let taxVal3 = sub3 * taxRate3 / 100;
                    for (let u = price4 - range4; u <= price4 + range4; u += step) {
                        let sub4 = quanlity4 * u;
                        let taxVal4 = sub4 * taxRate4 / 100;
                        for (let v = price5 - range5; v <= price5 + range5; v += step) {
                            
                            let sub5 = quanlity5 * v;
                            let taxVal5 = sub5 * taxRate5 / 100;

                            let sub = sub1 + sub2 + sub3 + sub4 + sub5;
                            let taxVal = taxVal1 + taxVal2 + taxVal3 + taxVal4 + taxVal5;
                            taxVal = Math.round(taxVal);
                            let calculatedTotal = sub + taxVal;

                            totalRange.push(calculatedTotal);
                            if (calculatedTotal === total) {
                            // console.log('Found prices:', {x,y, z });
                                
                                $('#list-result').append(
                                    `<li class="list-group-item">
                                        HH1: <strong>${x}</strong> 
                                        -HH2: <strong>${y}</strong> 
                                        -HH3: <strong>${z}</strong> 
                                        -HH4: <strong>${u}</strong> 
                                        -HH5: <strong>${v}</strong>
                                    </li>`);
                                
                            }
                            if (Date.now() - startTime >= timeout) {
                                console.log('time out');
                                found = true;
                            }
                        }
                    }
                    
                }
                if (found) break;
            }
            if (found) break;
        }
         
        let max = Math.max(...totalRange);
        let min = Math.min(...totalRange);
        $('#total-range').html(`Giá trị tìm được khoảng: <strong> ${formatNumber(min)} ... ${formatNumber(max)}</strong>`);
    });

        
    
});
    
    
</script>
</body>
</html>